# =============================================================================
# Spring AI Bedrock 챗봇 설정 파일
# =============================================================================
# 이 파일은 AWS Bedrock의 Claude 모델 연동을 위한 Spring AI 설정입니다.
# 보안을 위해 모든 AWS 자격증명은 환경변수로 설정해야 합니다.
# =============================================================================

spring:
  application:
    name: chatbot

  # ===========================================================================
  # AWS Bedrock 연결 설정
  # ===========================================================================
  # AWS Bedrock 서비스 연결을 위한 설정입니다.
  # Spring AI는 AWS SDK 자격증명 체인을 따릅니다:
  #   1. Spring AI 속성 (아래 설정)
  #   2. Java 시스템 속성
  #   3. 환경변수 (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY)
  #   4. Web Identity Token
  #   5. 자격증명 프로필 파일 (~/.aws/credentials)
  #   6. EC2 컨테이너 자격증명
  # ===========================================================================
  ai:
    bedrock:
      aws:
        # AWS 리전 - Bedrock이 사용 가능한 리전을 지정
        # 주요 리전: us-east-1, us-west-2, eu-west-1, ap-northeast-1
        region: ${AWS_REGION:us-east-1}

        # AWS 자격증명 - 보안을 위해 환경변수 사용 권장
        # 절대로 실제 자격증명을 소스코드에 커밋하지 마세요!
        access-key: ${AWS_ACCESS_KEY_ID:}
        secret-key: ${AWS_SECRET_ACCESS_KEY:}

        # API 호출 타임아웃 설정
        # 긴 응답에서 타임아웃 에러가 발생하면 이 값을 늘리세요
        timeout: 5m

      # =========================================================================
      # Claude 모델 설정
      # =========================================================================
      # Claude 모델과 생성 파라미터를 설정합니다.
      # 이 설정들은 응답 품질, 창의성, 토큰 사용량에 영향을 줍니다.
      # =========================================================================
      converse:
        chat:
          options:
            # 모델 ID - Bedrock에서 사용 가능한 Claude 모델:
            #   - anthropic.claude-3-5-sonnet-20241022-v2:0 (Claude 3.5 Sonnet v2 - 권장)
            #   - anthropic.claude-3-5-sonnet-20240620-v1:0 (Claude 3.5 Sonnet v1)
            #   - anthropic.claude-3-opus-20240229-v1:0     (Claude 3 Opus - 최고 성능)
            #   - anthropic.claude-3-haiku-20240307-v1:0   (Claude 3 Haiku - 가장 빠름)
            model: ${BEDROCK_MODEL_ID:anthropic.claude-3-5-sonnet-20241022-v2:0}

            # Temperature (0.0 ~ 1.0)
            # 응답의 무작위성을 조절합니다:
            #   - 0.0: 결정적이고 집중된 응답
            #   - 0.5: 창의성과 일관성의 균형
            #   - 1.0: 최대 창의성, 더 다양한 응답
            # 권장: 대화형 챗봇에는 0.7
            temperature: 0.7

            # 최대 토큰 수
            # 생성되는 응답의 최대 토큰 수
            # Claude 3.5 Sonnet은 최대 8192 출력 토큰 지원
            # 높은 값은 더 긴 응답을 허용하지만 비용과 지연시간 증가
            max-tokens: 4096

            # Top-K 샘플링
            # 각 단계에서 가장 확률이 높은 상위 K개 토큰으로 제한
            # 낮은 값 (10-40) = 더 집중된 응답
            # 높은 값 (100+) = 더 다양한 어휘
            top-k: 40

            # Top-P (Nucleus) 샘플링
            # 누적 확률이 P 이상인 가장 작은 토큰 집합에서 선택
            #   - 0.1: 매우 집중적이고 예측 가능
            #   - 0.9: 다양하면서도 불가능한 토큰 제외
            #   - 1.0: 모든 토큰 고려
            # Top-K와 함께 작동; 보통 하나를 높게 설정하고 다른 하나를 조정
            top-p: 0.9

  # ===========================================================================
  # Thymeleaf 템플릿 엔진 설정
  # ===========================================================================
  thymeleaf:
    # 개발 중에는 템플릿 캐싱 비활성화 (운영 환경에서는 활성화)
    cache: false
    # 템플릿 파일 위치와 확장자
    prefix: classpath:/templates/
    suffix: .html

  # ===========================================================================
  # MVC 비동기 설정
  # ===========================================================================
  mvc:
    async:
      # SSE 스트리밍을 위한 비동기 요청 타임아웃 (5분)
      # AI 응답 생성 예상 시간보다 길어야 합니다
      request-timeout: 300000

# =============================================================================
# 서버 설정
# =============================================================================
server:
  port: 8080

# =============================================================================
# 로깅 설정
# =============================================================================
# 요청/응답 상세 정보를 보려면 Spring AI를 DEBUG로 설정
# 운영 환경에서는 로그 양을 줄이기 위해 INFO로 설정
logging:
  level:
    org.springframework.ai: DEBUG
    software.amazon.awssdk: INFO
